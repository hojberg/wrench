(function(){var k={},d={routes:{}},i={},f=window,l=document;k.VERSION="0.0.1";i.add=function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false);return true}else if(b.attachEvent){if(a==="DOMContentLoaded"){b=f;a="load"}return b.attachEvent("on"+a,c)}else return false};d.route2Hash=function(b,a){var c=b,e=1;if(typeof a!=="undefined"){c+="?";for(var g in a)if(a.hasOwnProperty(g)){if(e!==1)c+="&";c+=g+"="+a[g];e++}}b=f.location.hash!==""&&f.location.hash!=="#"&&f.location.hash.indexOf(b)===
-1?f.location.hash+";"+c:c;f.location.hash=b};d.lastHash="/";d.hashChanged=function(){return f.location.hash!=d.lastHash&&f.location.hash!="#"+d.lastHash};d.partialChanged=function(b){if(d.hashChanged()){for(var a=d.lastHash.replace("#","").split(";"),c=f.location.hash.replace("#","").split(";"),e=0;e<a.length;e++)if(a[e].indexOf(b)==0){var g=a[e];break}else g="";for(e=0;e<c.length;e++)if(c[e].indexOf(b)==0){var h=c[e];break}else h="";return g!==h}else return false};d.locate=function(){if(d.hashChanged()){var b=
f.location.hash.replace("#","").split(";"),a=b.length,c={},e="";if(a>0&&b[0]!=="")for(var g=0;g<a;g++){var h=b[g].split("?");e=h.shift();if(e in d.routes&&d.partialChanged(e)){if(h.length>0&&typeof h[0]!=="undefined"){h=h[0].split("&");for(var m=h.length,j=0;j<m;j++)c[h[j].split("=")[0]]=h[j].split("=")[1]}d.routes[e](c)}}else"/"in d.routes&&d.routes["/"]()}d.lastHash=f.location.hash};d.attachFormRoutes=function(){for(var b=0;b<l.forms.length;b++){var a=l.forms[b],c={};a.action.indexOf("#")==0&&i.add(a,
"submit",function(e){for(var g=0;g<a.elements.length;g++)c[a.elements[g].id]=a.elements[g].value;d.route2Hash(a.action.replace("#",""),c);e.preventDefault()})}};var n={run:function(b){var a=this,c=function(){d.locate();d.attachFormRoutes();typeof a.init==="function"&&a.init()};i.add(l,"DOMContentLoaded",c);"onhashchange"in f?i.add(f,"hashchange",d.locate):setInterval(d.locate,200);b&&c();return a},route2Hash:function(b,a){d.route2Hash(b,a)}};k.appify=function(b){function a(){}a.prototype=n;var c=
new a;for(var e in b)if(b.hasOwnProperty(e))c[e]=b[e];return c};f.route=function(b,a){if(typeof a==="function"){d.routes[b]=a;return function(c){d.route2Hash(b,c,true)}}else return{to:function(c){d.routes[b]=c;return function(e){d.route2Hash(b,e,true)}}}};f.wrench=k})();