(function(){var k={},c={routes:{}},i={},f=window,l=document;k.VERSION="0.0.1";i.add=function(a,b,d){if(a.addEventListener){a.addEventListener(b,d,false);return true}else if(a.attachEvent){if(b==="DOMContentLoaded"){a=f;b="load"}return a.attachEvent("on"+b,d)}else return false};c.changeRoute=function(a,b,d){var e=a,h=1;if(typeof b!=="undefined"){e+="?";for(var g in b)if(b.hasOwnProperty(g)){if(h!==1)e+="&";e+=g+"="+b[g];h++}}a=f.location.hash!==""&&f.location.hash!=="#"&&f.location.hash.indexOf(a)===
-1?f.location.hash+";"+e:e;c.lastRoute=d?f.location.hash:a;f.location.hash=a};c.lastRoute="/";c.hashChanged=function(){var a=f.location.hash!=c.lastRoute&&f.location.hash!="#"+c.lastRoute;c.lastRoute=f.location.hash;return a};c.lastFragments=[];c.fragmentChanged=function(){if(c.hashChanged()&&c.lastFragments.length>0)for(var a=0;a<c.lastFragments.length;a++);else return false};c.locate=function(){if(c.hashChanged()){var a=f.location.hash.replace("#","").split(";"),b=a.length,d={},e="";if(b>0&&a[0]!==
"")for(var h=0;h<b;h++){var g=a[h].split("?");e=g.shift();if(g.length>0&&typeof g[0]!=="undefined"){g=g[0].split("&");for(var m=g.length,j=0;j<m;j++)d[g[j].split("=")[0]]=g[j].split("=")[1]}e in c.routes&&c.routes[e](d)}else"/"in c.routes&&c.routes["/"]()}};c.attachFormRoutes=function(){for(var a=0;a<l.forms.length;a++){var b=l.forms[a],d={};b.action.indexOf("#")==0&&i.add(b,"submit",function(e){for(var h=0;h<b.elements.length;h++)d[b.elements[h].id]=b.elements[h].value;c.changeRoute(b.action.replace("#",
""),d,true);e.preventDefault()})}};var n={run:function(a){var b=this,d=function(){c.locate();c.attachFormRoutes();typeof b.init==="function"&&b.init()};i.add(l,"DOMContentLoaded",d);"onhashchange"in f?i.add(f,"hashchange",c.locate):setInterval(c.locate,500);a&&d();return b},changeRoute:function(a,b){c.changeRoute(a,b)}};k.appify=function(a){function b(){}b.prototype=n;var d=new b;for(var e in a)if(a.hasOwnProperty(e))d[e]=a[e];return d};f.route=function(a,b){if(typeof b==="function"){c.routes[a]=
b;return function(d){c.changeRoute(a,d);b(d)}}else return{to:function(d){c.routes[a]=d;return function(e){c.changeRoute(a,e);d(e)}}}};f.wrench=k})();