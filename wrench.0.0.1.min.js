(function(){var n={},e={routes:{},lastHash:"/"},m={},i=window,o=document;n.VERSION="0.0.1";var p=function(b,a){function f(){}f.prototype=b;var d=new f;if(a)for(var c in a)if(a.hasOwnProperty(c))d[c]=a[c];return d};m.add=function(b,a,f){if(b.addEventListener){b.addEventListener(a,f,false);return true}else if(b.attachEvent){if(a==="DOMContentLoaded"){b=i;a="load"}return b.attachEvent("on"+a,f)}else return false};e.route2Hash=function(b,a,f){var d=b,c=1;a=p(a);if(typeof a!=="undefined"){if(b.indexOf("/")!==
-1&&b.indexOf(":")!==-1)for(var g=b.split("/"),h=0;h<g.length;h++)if(g[h].indexOf(":")===0)if(g[h].substr(1)in a){d=d.replace(g[h],a[g[h].substr(1)]);delete a[g[h].substr(1)]}for(var j in a)if(a.hasOwnProperty(j)){d+=c!==1?"&":"?";d+=j+"="+a[j];c++}}c="";if(i.location.hash===""||i.location.hash==="#")c=d;else{c=i.location.hash;j=b;a=b.indexOf(":");if(a!==-1)j=b.substr(0,a-1);b=new RegExp(j+"[^;]*");c=c.replace(b,d);if(c===i.location.hash&&!b.test(c))c=c+";"+d}e.lastHash=f?d:i.location.hash;i.location.hash=
c};e.hashChanged=function(){return i.location.hash!=e.lastHash&&i.location.hash!="#"+e.lastHash};e.partialChanged=function(b){if(e.hashChanged()){for(var a=e.lastHash.replace("#","").split(";"),f=i.location.hash.replace("#","").split(";"),d="",c="",g=0;g<a.length;g++)if(a[g].indexOf(b)===0){d=a[g];break}for(a=0;a<f.length;a++)if(f[a].indexOf(b)===0){c=f[a];break}console.log("partial '"+b+"' changed?: "+(d!==c).toString());console.log("last: "+d+" || current: "+c);return d!==c}else return false};e.locate=
function(){if(e.hashChanged()){var b=i.location.hash.replace("#","").split(";"),a=b.length;if(a>0&&b[0]!=="")for(var f=0;f<a;f++){var d=b[f].split("?"),c=d.shift(),g={},h="";if(c in e.routes)h=c;else if(c.indexOf("/")!==-1)for(var j in e.routes)if(j.indexOf(":")!==-1){var k=j.indexOf(":")-1;if(j.substr(0,k)===c.substr(0,k)){h=j;break}}if(h!==""&&e.partialChanged(c)){if(h.indexOf("/")!==-1&&h.indexOf(":")!==-1){k=h.split("/");c=c.split("/");for(var l=0;l<k.length;l++)if(k[l].indexOf(":")===0&&c[l])g[k[l].replace(":",
"")]=c[l]}if(d.length>0&&typeof d[0]!=="undefined"){d=d[0].split("&");k=d.length;for(c=0;c<k;c++)g[d[c].split("=")[0]]=d[c].split("=")[1]}console.log("calling route: "+h);e.routes[h](g)}}else"/"in e.routes&&e.routes["/"]()}e.lastHash=i.location.hash};e.attachFormRoutes=function(){for(var b=o.forms,a=function(d){for(var c=d.target,g=c.elements,h={},j=0;j<g.length;j++)h[g[j].id]=g[j].value;e.route2Hash(c.action.replace("#",""),h);d.preventDefault()},f=0;f<b.length;f++)b[f].action.indexOf("#")===0&&
m.add(b[f],"submit",a)};var q={run:function(b){var a=this,f=function(){e.locate();e.attachFormRoutes();typeof a.init==="function"&&a.init()};m.add(o,"DOMContentLoaded",f);"onhashchange"in i?m.add(i,"hashchange",e.locate):setInterval(e.locate,200);b&&f();return a},route2Hash:function(b,a){e.route2Hash(b,a)}};n.appify=function(b){return p(q,b)};i.route=function(b,a){if(typeof a==="function"){e.routes[b]=a;return function(f){e.route2Hash(b,f,true);a.apply(null,arguments)}}else return{to:function(f){e.routes[b]=
f;return function(d){e.route2Hash(b,d,true);f.apply(null,arguments)}}}};i.wrench=n})();