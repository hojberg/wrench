(function(){var m={},e={routes:{}},l={},g=window,n=document;m.VERSION="0.0.1";l.add=function(b,a,d){if(b.addEventListener){b.addEventListener(a,d,false);return true}else if(b.attachEvent){if(a==="DOMContentLoaded"){b=g;a="load"}return b.attachEvent("on"+a,d)}else return false};e.route2Hash=function(b,a){var d=b,c=1;if(typeof a!=="undefined"){d+="?";for(var f in a)if(a.hasOwnProperty(f)){if(c!==1)d+="&";d+=f+"="+a[f];c++}}b=g.location.hash!==""&&g.location.hash!=="#"&&g.location.hash.indexOf(b)===
-1?g.location.hash+";"+d:d;g.location.hash=b};e.lastHash="/";e.hashChanged=function(){return g.location.hash!=e.lastHash&&g.location.hash!="#"+e.lastHash};e.partialChanged=function(b){if(e.hashChanged()){for(var a=e.lastHash.replace("#","").split(";"),d=g.location.hash.replace("#","").split(";"),c=0;c<a.length;c++)if(a[c].indexOf(b)==0){var f=a[c];break}else f="";for(c=0;c<d.length;c++)if(d[c].indexOf(b)==0){var h=d[c];break}else h="";return f!==h}else return false};e.locate=function(){if(e.hashChanged()){var b=
g.location.hash.replace("#","").split(";"),a=b.length,d={},c="";if(a>0&&b[0]!=="")for(var f=0;f<a;f++){var h=b[f].split("?");partial=h.shift();c=undefined;if(partial in e.routes)c=partial;else if(partial.indexOf("/")!==-1)for(var j in e.routes)if(j.indexOf("/")!==-1)if(j===partial){c=j;break}else if(j.indexOf(":")!==-1){var i=j.indexOf(":")-1;if(j.substr(0,i)===partial.substr(0,i)){c=j;break}}if(c&&e.partialChanged(partial)){if(c.indexOf("/")!==-1&&c.indexOf(":")!==-1){i=c.split("/");var k=partial.split("/");
for(f=0;f<i.length;f++)if(i[f].indexOf(":")===0)if(k[f])d[i[f].replace(":","")]=k[f]}if(h.length>0&&typeof h[0]!=="undefined"){h=h[0].split("&");i=h.length;for(k=0;k<i;k++)d[h[k].split("=")[0]]=h[k].split("=")[1]}e.routes[c](d)}}else"/"in e.routes&&e.routes["/"]()}e.lastHash=g.location.hash};e.attachFormRoutes=function(){for(var b=0;b<n.forms.length;b++){var a=n.forms[b],d={};a.action.indexOf("#")==0&&l.add(a,"submit",function(c){for(var f=0;f<a.elements.length;f++)d[a.elements[f].id]=a.elements[f].value;
e.route2Hash(a.action.replace("#",""),d);c.preventDefault()})}};var o={run:function(b){var a=this,d=function(){e.locate();e.attachFormRoutes();typeof a.init==="function"&&a.init()};l.add(n,"DOMContentLoaded",d);"onhashchange"in g?l.add(g,"hashchange",e.locate):setInterval(e.locate,200);b&&d();return a},route2Hash:function(b,a){e.route2Hash(b,a)}};m.appify=function(b){function a(){}a.prototype=o;var d=new a;for(var c in b)if(b.hasOwnProperty(c))d[c]=b[c];return d};g.route=function(b,a){var d=function(c){e.route2Hash(b,
c,true)};if(typeof a==="function"){e.routes[b]=a;return d}else return{to:function(c){e.routes[b]=c;return d}}};g.wrench=m})();