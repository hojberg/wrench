(function(){var o={},d={routes:{}},m={},i=window,n=document;o.VERSION="0.0.1";m.add=function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false);return true}else if(b.attachEvent){if(a==="DOMContentLoaded"){b=i;a="load"}return b.attachEvent("on"+a,c)}else return false};d.route2Hash=function(b,a){var c=b,e=1;if(typeof a!=="undefined"){if(b.indexOf("/")!==-1&&b.indexOf(":")!==-1)for(var h=b.split("/"),f=0;f<h.length;f++)if(h[f].indexOf(":")===0)if(h[f].substr(1)in a){c=c.replace(h[f],a[h[f].substr(1)]);
delete a[h[f].substr(1)]}for(var g in a)if(a.hasOwnProperty(g)){c+=e!==1?"&":"?";c+=g+"="+a[g];e++}}b=i.location.hash!==""&&i.location.hash!=="#"&&i.location.hash.indexOf(b)===-1?i.location.hash+";"+c:c;i.location.hash=b};d.lastHash="/";d.hashChanged=function(){return i.location.hash!=d.lastHash&&i.location.hash!="#"+d.lastHash};d.partialChanged=function(b){if(d.hashChanged()){for(var a=d.lastHash.replace("#","").split(";"),c=i.location.hash.replace("#","").split(";"),e="",h="",f=0;f<a.length;f++)if(a[f].indexOf(b)===
0){e=a[f];break}for(a=0;a<c.length;a++)if(c[a].indexOf(b)===0){h=c[a];break}return e!==h}else return false};d.locate=function(){if(d.hashChanged()){var b=i.location.hash.replace("#","").split(";"),a=b.length,c={},e="";if(a>0&&b[0]!=="")for(var h=0;h<a;h++){var f=b[h].split("?"),g=f.shift();if(g in d.routes)e=g;else if(g.indexOf("/")!==-1)for(var k in d.routes)if(k.indexOf("/")!==-1)if(k===g){e=k;break}else if(k.indexOf(":")!==-1){var j=k.indexOf(":")-1;if(k.substr(0,j)===g.substr(0,j)){e=k;break}}if(e!==
""&&d.partialChanged(g)){if(e.indexOf("/")!==-1&&e.indexOf(":")!==-1){j=e.split("/");g=g.split("/");for(var l=0;l<j.length;l++)if(j[l].indexOf(":")===0&&g[l])c[j[l].replace(":","")]=g[l]}if(f.length>0&&typeof f[0]!=="undefined"){f=f[0].split("&");j=f.length;for(g=0;g<j;g++)c[f[g].split("=")[0]]=f[g].split("=")[1]}d.routes[e](c)}}else"/"in d.routes&&d.routes["/"]()}d.lastHash=i.location.hash};d.attachFormRoutes=function(){for(var b=function(c){for(var e=c.target,h={},f=0;f<e.elements.length;f++)h[e.elements[f].id]=
e.elements[f].value;d.route2Hash(e.action.replace("#",""),h);c.preventDefault()},a=0;a<n.forms.length;a++)n.forms[a].action.indexOf("#")===0&&m.add(n.forms[a],"submit",b)};var p={run:function(b){var a=this,c=function(){d.locate();d.attachFormRoutes();typeof a.init==="function"&&a.init()};m.add(n,"DOMContentLoaded",c);"onhashchange"in i?m.add(i,"hashchange",d.locate):setInterval(d.locate,200);b&&c();return a},route2Hash:function(b,a){d.route2Hash(b,a)}};o.appify=function(b){function a(){}a.prototype=
p;var c=new a;for(var e in b)if(b.hasOwnProperty(e))c[e]=b[e];return c};i.route=function(b,a){var c=function(e){d.route2Hash(b,e,true)};if(typeof a==="function"){d.routes[b]=a;return c}else return{to:function(e){d.routes[b]=e;return c}}};i.wrench=o})();