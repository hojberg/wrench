(function(){var n={},f={routes:{},lastHash:"/"},m={},j=window,o=document;n.VERSION="0.0.1";var p=function(b,c){function d(){}d.prototype=b;var e=new d;if(c)for(var a in c)if(c.hasOwnProperty(a))e[a]=c[a];return e};m.add=function(b,c,d){if(b.addEventListener){b.addEventListener(c,d,false);return true}else if(b.attachEvent){if(c==="DOMContentLoaded"){b=j;c="load"}return b.attachEvent("on"+c,d)}else return false};f.route2Hash=function(b,c){var d=b,e=1,a={};for(var g in c)if(c.hasOwnProperty(g))a[g]=
c[g];if(typeof a!=="undefined"){if(b.indexOf("/")!==-1&&b.indexOf(":")!==-1){g=b.split("/");for(var h=0;h<g.length;h++)if(g[h].indexOf(":")===0)if(g[h].substr(1)in a){d=d.replace(g[h],a[g[h].substr(1)]);delete a[g[h].substr(1)]}}for(var i in a)if(a.hasOwnProperty(i)){d+=e!==1?"&":"?";d+=i+"="+a[i];e++}}e="";if(j.location.hash===""||j.location.hash==="#")e=d;else{e=j.location.hash;a=b;i=b.indexOf(":");if(i!==-1)a=b.substr(0,i-1);a=new RegExp(a+"[^;]*");e=e.replace(a,d);if(e===j.location.hash&&!a.test(e))e=
e+";"+d}j.location.hash=e};f.hashChanged=function(){return j.location.hash!=f.lastHash&&j.location.hash!="#"+f.lastHash};f.partialChanged=function(b){if(f.hashChanged()){for(var c=f.lastHash.replace("#","").split(";"),d=j.location.hash.replace("#","").split(";"),e="",a="",g=0;g<c.length;g++)if(c[g].indexOf(b)===0){e=c[g];break}for(c=0;c<d.length;c++)if(d[c].indexOf(b)===0){a=d[c];break}return e!==a}else return false};f.locate=function(){if(f.hashChanged()){var b=j.location.hash.replace("#","").split(";"),
c=b.length;if(c>0&&b[0]!=="")for(var d=0;d<c;d++){var e=b[d].split("?"),a=e.shift(),g={},h="";if(a in f.routes)h=a;else if(a.indexOf("/")!==-1)for(var i in f.routes)if(i.indexOf(":")!==-1){var k=i.indexOf(":")-1;if(i.substr(0,k)===a.substr(0,k)){h=i;break}}if(h!==""&&f.partialChanged(a)){if(h.indexOf("/")!==-1&&h.indexOf(":")!==-1){k=h.split("/");a=a.split("/");for(var l=0;l<k.length;l++)if(k[l].indexOf(":")===0&&a[l])g[k[l].replace(":","")]=a[l]}if(e.length>0&&typeof e[0]!=="undefined"){e=e[0].split("&");
k=e.length;for(a=0;a<k;a++)g[e[a].split("=")[0]]=e[a].split("=")[1]}f.routes[h](g)}}else"/"in f.routes&&f.routes["/"]()}f.lastHash=j.location.hash};f.attachFormRoutes=function(){for(var b=o.forms,c=function(e){for(var a=e.target,g=a.elements,h={},i=0;i<g.length;i++)h[g[i].id]=g[i].value;f.route2Hash(a.action.replace("#",""),h);e.preventDefault()},d=0;d<b.length;d++)b[d].action.indexOf("#")===0&&m.add(b[d],"submit",c)};var q={run:function(b){var c=this,d=function(){f.locate();f.attachFormRoutes();
typeof c.init==="function"&&c.init()};m.add(o,"DOMContentLoaded",d);"onhashchange"in j?m.add(j,"hashchange",f.locate):setInterval(f.locate,200);b&&d();return c},route2Hash:function(b,c){f.route2Hash(b,c)}};n.appify=function(b){return p(q,b)};j.route=function(b,c){if(typeof c==="function"){f.routes[b]=c;return function(d){f.route2Hash(b,d);c.apply(null,arguments)}}else return{to:function(d){f.routes[b]=d;return function(e){f.route2Hash(b,e);d.apply(null,arguments)}}}};j.wrench=n})();