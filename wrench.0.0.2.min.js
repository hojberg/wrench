(function(){var n={},f={routes:{},lastHash:"/"},m={},i=window,o=document;n.VERSION="0.0.1";var p=function(b,a){function d(){}d.prototype=b;var e=new d;if(a)for(var c in a)if(a.hasOwnProperty(c))e[c]=a[c];return e};m.add=function(b,a,d){if(b.addEventListener){b.addEventListener(a,d,false);return true}else if(b.attachEvent){if(a==="DOMContentLoaded"){b=i;a="load"}return b.attachEvent("on"+a,d)}else return false};f.route2Hash=function(b,a,d){var e=b,c=1,g={};for(var h in a)if(a.hasOwnProperty(h))g[h]=
a[h];if(typeof d==="undefined")d=false;if(typeof g!=="undefined"){if(b.indexOf("/")!==-1&&b.indexOf(":")!==-1){a=b.split("/");for(h=0;h<a.length;h++)if(a[h].indexOf(":")===0)if(a[h].substr(1)in g){e=e.replace(a[h],g[a[h].substr(1)]);delete g[a[h].substr(1)]}}for(var j in g)if(g.hasOwnProperty(j)){e+=c!==1?"&":"?";e+=j+"="+g[j];c++}}c="";if(i.location.hash===""||i.location.hash==="#"||!d)c=e;else{d=i.location.hash.replace("#","").split(";")[0].split("?")[0];if(d in f.routes&&!f.routes[d].isPartial)c=
e;else{d=i.location.hash;c=b;g=b.indexOf(":");if(g!==-1)c=b.substr(0,g-1);b=new RegExp(c+"[^;]*");c=d.replace(b,e);if(c===i.location.hash&&!b.test(c))c=c+";"+e}}i.location.hash=c};f.hashChanged=function(){return i.location.hash!=f.lastHash&&i.location.hash!="#"+f.lastHash};f.partialChanged=function(b){if(f.hashChanged()){for(var a=f.lastHash.replace("#","").split(";"),d=i.location.hash.replace("#","").split(";"),e="",c="",g=0;g<a.length;g++)if(a[g].indexOf(b)===0){e=a[g];break}for(a=0;a<d.length;a++)if(d[a].indexOf(b)===
0){c=d[a];break}return e!==c}else return false};f.locate=function(){if(f.hashChanged()){var b=i.location.hash.replace("#","").split(";"),a=b.length;if(a>0&&b[0]!=="")for(var d=0;d<a;d++){var e=b[d].split("?"),c=e.shift(),g={},h="";if(c in f.routes)h=c;else if(c.indexOf("/")!==-1)for(var j in f.routes)if(j.indexOf(":")!==-1){var k=j.indexOf(":")-1;if(j.substr(0,k)===c.substr(0,k)){h=j;break}}if(h!==""&&f.partialChanged(c)){if(h.indexOf("/")!==-1&&h.indexOf(":")!==-1){k=h.split("/");c=c.split("/");
for(var l=0;l<k.length;l++)if(k[l].indexOf(":")===0&&c[l])g[k[l].replace(":","")]=c[l]}if(e.length>0&&typeof e[0]!=="undefined"){e=e[0].split("&");k=e.length;for(c=0;c<k;c++)g[e[c].split("=")[0]]=e[c].split("=")[1]}f.routes[h].func(g)}}else"/"in f.routes&&f.routes["/"].func()}f.lastHash=i.location.hash};f.removePartial=function(b){if(i.location.hash.indexOf(b)!==-1){for(var a=i.location.hash.replace("#","").split(";"),d="",e=0;e<a.length;e++)if(a[e].substr(0,b.length)!==b){if(d!=="")d+=";";d+=a[e]}i.location.hash=
d}};f.attachFormRoutes=function(){for(var b=o.forms,a=function(e){for(var c=e.target,g=c.elements,h={},j=0;j<g.length;j++)h[g[j].id]=g[j].value;f.route2Hash(c.action.replace("#",""),h);e.preventDefault()},d=0;d<b.length;d++)b[d].action.indexOf("#")===0&&m.add(b[d],"submit",a)};var q={run:function(b){var a=this,d=function(){f.locate();f.attachFormRoutes();typeof a.init==="function"&&a.init()};m.add(o,"DOMContentLoaded",d);"onhashchange"in i?m.add(i,"hashchange",f.locate):setInterval(f.locate,200);
b&&d();return a},route2Hash:function(b,a){f.route2Hash(b,a)},removePartial:function(b){f.removePartial(b)}};n.appify=function(b){return p(q,b)};i.route=function(b,a){if(typeof a==="undefined")a=false;return{to:function(d){f.routes[b]={func:d,isPartial:a};return function(e){f.route2Hash(b,e,a);d.apply(null,arguments)}}}};i.routePartial=function(b){return i.route(b,true)};i.wrench=n})();